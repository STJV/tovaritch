kind: pipeline
type: docker
name: default

workspace:
  base: /kileed
  path: src

steps:
- name: setup-workspace
  image: stjv/kileed-build-env
  commands:
  - bash drone.sh setup-workspace

- name: pylint
  image: stjv/kileed-build-env
  commands:
  - bash drone.sh pylint
  depends_on: [ 'setup-workspace' ]

- name: pydocstyle
  image: stjv/kileed-build-env
  commands:
  - bash drone.sh pydocstyle
  depends_on: [ 'setup-workspace' ]

- name: eslint
  image: stjv/kileed-build-env
  commands:
  - bash drone.sh eslint
  depends_on: [ 'setup-workspace' ]

- name: api-unit-tests
  image: stjv/kileed-build-env
  commands:
  - bash drone.sh api-unit-tests
  depends_on: [ 'setup-workspace' ]

- name: ui-unit-tests
  image: stjv/kileed-build-env
  commands:
  - bash drone.sh ui-unit-tests
  depends_on: [ 'setup-workspace' ]

- name: build-ui
  image: stjv/kileed-build-env
  commands:
  - bash drone.sh build-ui
  depends_on:
  - 'pylint'
  - 'pydocstyle'
  - 'eslint'
  - 'api-unit-tests'
  - 'ui-unit-tests'

- name: e2e-tests
  image: stjv/kileed-build-env
  commands:
  - bash drone.sh e2e-tests
  depends_on: ['build-ui']
